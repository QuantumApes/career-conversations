name: Update Hugging Face Space

on:
  push:
    branches:
      - main  # or whatever branch you use

jobs:
  sync-to-hf:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3

      - name: Install huggingface_hub
        run: pip install huggingface_hub

      - name: Push Updates to Hugging Face Space
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
        run: |
          python3 - <<EOF
          from huggingface_hub import HfApi, Repository
          import os

          space_id = "USERNAME/SPACE_NAME"  # e.g. quantumapes/career-twin
          api = HfApi()

          repo_dir = "hf_space_temp"

          # Clone your HF Space
          if os.path.exists(repo_dir):
              os.system(f"rm -rf {repo_dir}")

          api.repo_clone(
              repo_id=space_id,
              repo_type="space",
              local_dir=repo_dir,
              token=HF_TOKEN
          )

          # Copy updated files from your GitHub repo to the HF repo
          os.system(f"cp -r me {repo_dir}/me")

          # Commit + push
          os.system(f"cd {repo_dir} && git add . && git commit -m 'Auto-update from GitHub' || echo 'No changes' && git push")
          EOF
